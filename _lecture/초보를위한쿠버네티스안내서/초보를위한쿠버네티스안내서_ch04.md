---
layout: default
title: CH 4 쿠버네티스 기본 실습
parent: 초보를 위한 쿠버네티스 안내서
nav_order: 4
---

- 기본 명령어
- Pod
- ReplicaSet
- Deployment

<br>

## 기본 명령어
[강의 자료](https://subicura.com/k8s/guide/kubectl.html) 참고

<br>

## Pod
[강의 자료](https://subicura.com/k8s/guide/pod.html) 참고

- readinessProbe 설정을 해주지 않으면 기본적으로 모든 pod 에 다 요청을 하고, readinessProbe 설정을 해주면 readinessProbe 에 통과한 pod 에만 요청을 보내준다.
- 보통은 livenessProbe, readinessProbe 모두 적용 한다고 한다.(강의 자료 참고) 
- 정상 여부 판단 방법은 path 를 명시 했을때와 안했을때가 다르다.(실제로 이건 해보면서 확인을 해보자)
  - path 명시할 경우 해당 요청을 실제로 보내서 응답코드 200 으로 판단한다.
  - path 를 생략할 경우 해당 포트에 TCP 소켓 연결만을 확인한다. 해당 포트에서 수신 대기중이면 정상 상태라고 간주한다.

아래는 chatGPT 로 공부하던거 발췌

> LivenessProbe와 ReadinessProbe에서 설정한 대로 체크를 할 때, 정상 여부는 Probe에서 사용하는 확인 방법에 따라 결정됩니다.<br>
> LivenessProbe는 컨테이너의 상태를 지속적으로 확인하며, 컨테이너가 살아있는지 여부를 판단합니다. LivenessProbe에서는 주로 컨테이너 내부의 프로세스 상태를 체크하거나,
> 네트워크 상태를 확인하는 방법을 사용합니다. 예를 들어, HTTP GET 요청을 보내서 응답을 확인하는 방법이 사용될 수 있습니다. 만약 LivenessProbe에서 지정한 확인 방법에 실패하면, Kubernetes는 해당 컨테이너를 다시 시작합니다.<br>
> ReadinessProbe는 컨테이너가 서비스 요청을 처리할 준비가 되었는지 여부를 판단합니다. ReadinessProbe에서는 주로 컨테이너가 사용하는 포트가 열려 있는지 여부를 확인하는 방법이 사용됩니다.
> 예를 들어, TCP 소켓 연결을 시도하고 연결이 성공하면 준비 상태로 판단할 수 있습니다. 만약 ReadinessProbe에서 지정한 확인 방법에 실패하면, 해당 컨테이너로의 서비스 요청은 전달되지 않습니다.<br>
> 따라서, LivenessProbe와 ReadinessProbe에서 지정한 확인 방법이 성공하면, Kubernetes는 해당 컨테이너가 정상 상태로 간주합니다. 실패하면, Kubernetes는 해당 컨테이너를 다시 시작하거나, 서비스 요청을 전달하지 않습니다.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: echo-health
  labels:
    app: echo
spec:
  containers:
    - name: app
      image: ghcr.io/subicura/echo:v1
      livenessProbe:
        httpGet:
          path: /
          port: 3000
      readinessProbe:
        httpGet:
          path: /
          port: 3000
```

<br>

## ReplicaSet

[강의 자료](https://subicura.com/k8s/guide/replicaset.html) 참고

```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: echo-rs
spec:
  replicas: 1
  selector:
    matchLabels:
      app: echo
      tier: app
  template:
    metadata:
      labels:
        app: echo
        tier: app
    spec:
      containers:
        - name: echo
          image: ghcr.io/subicura/echo:v1
```

![](/images/replicaset_label.png)

스크립트를 보면 알 수 있듯이 label 을 없애면 desired state 가 아니기 때문에 하나를 만드는데,
신기한건 없앤 것에 label 을 다시 추가해주면 두 개가 되니까 또 desired state 이 아니니까 하나를 없앤다.

<br>

## Deployment

[강의 자료](https://subicura.com/k8s/guide/deployment.html) 참고

